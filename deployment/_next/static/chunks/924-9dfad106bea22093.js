"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[924],{4260:(e,t,a)=>{a.d(t,{DX:()=>o,HZ:()=>n,MF:()=>i,UE:()=>r,vn:()=>c,zb:()=>s});let n=[{id:"1",name:"Admin User",email:"admin@oasiscapitalfinance.com",role:"admin"},{id:"2",name:"Sarah Johnson",email:"sarah@oasiscapitalfinance.com",role:"manager"},{id:"3",name:"Michael Chen",email:"michael@oasiscapitalfinance.com",role:"manager"},{id:"101",name:"Acme Corporation",email:"contact@acmecorp.com",role:"client"},{id:"102",name:"Global Investments Ltd",email:"info@globalinvest.com",role:"client"},{id:"103",name:"Tech Ventures Inc",email:"hello@techventures.com",role:"client"}];function r(e){return"admin"===e||"manager"===e}function o(e){return"admin"===e||"manager"===e}function c(e){return"admin"===e||"manager"===e}function s(e){return"admin"===e}function i(e){return"admin"===e||"manager"===e}},4541:(e,t,a)=>{a.d(t,{A:()=>m,O:()=>u});var n=a(2372),r=a(2115),o=a(4260),c=a(5731);let s=(0,r.createContext)(void 0),i="gantt-auth-user",l="gantt-current-project";function d(e){return{id:String(e.id),name:e.name,description:e.description||"",clientId:e.client_id?String(e.client_id):void 0,clientName:e.client_name||void 0,createdBy:e.owner_id?String(e.owner_id):"unknown",createdAt:new Date(e.created_at),color:e.color,ownerId:e.owner_id?String(e.owner_id):void 0}}function u(e){let{children:t}=e,[a,u]=(0,r.useState)(null),[m,p]=(0,r.useState)([]),[h,y]=(0,r.useState)(null),[g,f]=(0,r.useState)(!1),[S,_]=(0,r.useState)(!1),[k,E]=(0,r.useState)([]),b=(0,r.useRef)(null),v=(0,r.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];_(!0);try{let t;if((null==e?void 0:e.role)==="client"){let a=Number(e.id);t=await c.Nq.getByClient(a)}else t=await c.Nq.getAll();if(t.success&&t.data){let e=t.data.map(d);p(e);let a=localStorage.getItem(l);if(a){let t=e.find(e=>e.id===a);t?y(t):e.length>0&&y(e[0])}else e.length>0&&y(e[0])}else console.error("Failed to fetch projects:",t.error),p([])}catch(e){console.error("Error fetching projects:",e),p([])}finally{_(!1),t&&f(!0)}},[]);(0,r.useEffect)(()=>{(async()=>{let e=localStorage.getItem("gantt-user-data"),t=localStorage.getItem(i),a=null;if(e)try{a=JSON.parse(e)}catch(e){}!a&&t&&(a=o.HZ.find(e=>e.id===t)||null),b.current=a,u(a),await v(a,!0)})()},[v]),(0,r.useEffect)(()=>{let e=e=>{var t,a;if((null==(t=e.data)?void 0:t.type)==="GANTT_LOGIN_SUCCESS"&&(null==(a=e.data)?void 0:a.user)){let t=e.data.user,a={id:String(t.id),name:t.full_name||t.username,email:t.email,role:t.role};b.current=a,u(a),localStorage.setItem(i,String(t.id)),localStorage.setItem("gantt-user-data",JSON.stringify(a)),v(a)}};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)},[v]);let T=(0,r.useCallback)(e=>{y(e),e?localStorage.setItem(l,e.id):localStorage.removeItem(l)},[]),N=(0,r.useCallback)(e=>{let t=o.HZ.find(t=>t.id===e);t&&(b.current=t,u(t),localStorage.setItem(i,e),localStorage.setItem("gantt-user-data",JSON.stringify(t)),v(t))},[v]),w=(0,r.useCallback)(()=>{b.current=null,u(null),localStorage.removeItem(i),localStorage.removeItem("gantt-user-data"),fetch("/api/auth.php?action=logout",{method:"POST",credentials:"include"}).catch(()=>{}),v(null)},[v]),C=(0,r.useCallback)(async()=>{try{let e=await c.E3.getAll();if(e.success&&e.data){let t=e.data.map(e=>({id:e.id,name:e.name,description:e.description,projectType:e.project_type,color:e.color,taskCount:e.task_count,totalDurationDays:e.total_duration_days}));E(t)}}catch(e){console.error("Error loading templates:",e)}},[]),I=(0,r.useCallback)(async e=>{try{let n=await c.E3.get(e);if(n.success&&n.data){var t,a;let e=n.data;return{id:e.id,name:e.name,description:e.description,projectType:e.project_type,color:e.color,taskCount:(null==(t=e.tasks)?void 0:t.length)||0,totalDurationDays:e.total_duration_days,tasks:null==(a=e.tasks)?void 0:a.map(e=>({id:e.id,templateId:e.template_id,name:e.name,description:e.description,daysFromStart:e.days_from_start,durationDays:e.duration_days,priority:e.priority,isMilestone:e.is_milestone,taskOrder:e.task_order,dependencies:e.dependencies}))}}return null}catch(e){return console.error("Error loading template:",e),null}},[]),O=(0,r.useCallback)(async(e,t,a,n,r)=>{try{let o=b.current,s={name:e,description:t,color:"#14b8a6",owner_id:o&&Number(o.id)||1};a&&(s.template_id=a),n&&(s.start_date=n),r&&(s.client_id=Number(r));let i=await c.Nq.create(s);if(!i.success||!i.data)return console.error("Failed to create project:",i.error),null;{let e=d(i.data);return p(t=>[...t,e]),T(e),e}}catch(e){return console.error("Error creating project:",e),null}},[T]),j=(0,r.useCallback)(async(e,t)=>{let a=o.HZ.find(e=>e.id===t),n=Number(t);try{let t=await c.Nq.allocateToClient(Number(e),n,null==a?void 0:a.name);if(t.success&&t.data){let a=d(t.data);p(t=>t.map(t=>t.id===e?a:t))}else console.error("Failed to allocate project:",t.error)}catch(e){console.error("Error allocating project:",e)}},[]),P=(0,r.useCallback)(e=>m.filter(t=>t.clientId===e),[m]),J=(0,r.useCallback)(()=>o.HZ.filter(e=>"client"===e.role),[]),A=(0,r.useCallback)(async()=>{await v(b.current)},[v]);return(0,n.Y)(s.Provider,{value:{user:a,users:o.HZ,login:N,logout:w,isAuthenticated:!!a,projects:m,currentProject:h,setCurrentProject:T,createProject:O,allocateProjectToClient:j,getClientProjects:P,getAllClients:J,refreshProjects:A,loading:!g||S&&!g,templates:k,loadTemplates:C,getTemplateWithTasks:I},children:t})}function m(){let e=(0,r.useContext)(s);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},5731:(e,t,a)=>{a.d(t,{E3:()=>i,Jg:()=>s,Nq:()=>c,bI:()=>o});let n=a(9509).env.NEXT_PUBLIC_API_URL||"/api";async function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{var a;let r="".concat(n,"/").concat(e),o=await fetch(r,{...t,headers:{"Content-Type":"application/json",Accept:"application/json",...t.headers}}),c=await o.json();if(!o.ok)return{success:!1,error:c.error||c.message||"HTTP ".concat(o.status)};return{success:!0,data:null!=(a=c.data)?a:c,message:c.message}}catch(e){return console.error("API Error:",e),{success:!1,error:e instanceof Error?e.message:"Network error"}}}let o={getByProject:async e=>r("tasks.php?project_id=".concat(e)),get:async e=>r("tasks.php?id=".concat(e)),create:async e=>r("tasks.php",{method:"POST",body:JSON.stringify(e)}),update:async(e,t)=>r("tasks.php?id=".concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:async e=>r("tasks.php?id=".concat(e),{method:"DELETE"}),async reorder(e,t){let a=t.map(e=>{let{id:t,order:a}=e;return r("tasks.php?id=".concat(t),{method:"PUT",body:JSON.stringify({task_order:a})})});return await Promise.all(a),{success:!0}}},c={getAll:async()=>r("projects.php"),getByClient:async e=>r("projects.php?client_id=".concat(e)),get:async e=>r("projects.php?id=".concat(e)),create:async e=>r("projects.php",{method:"POST",body:JSON.stringify(e)}),update:async(e,t)=>r("projects.php?id=".concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:async e=>r("projects.php?id=".concat(e),{method:"DELETE"}),allocateToClient:async(e,t,a)=>r("projects.php?id=".concat(e),{method:"PUT",body:JSON.stringify({client_id:t,client_name:a})})},s={getByTask:async e=>r("comments.php?task_id=".concat(e)),create:async e=>r("comments.php",{method:"POST",body:JSON.stringify({task_id:e.task_id,user_id:e.user_id,user_name:e.user_name,comment:e.content})}),update:async(e,t)=>r("comments.php?id=".concat(e),{method:"PUT",body:JSON.stringify({comment:t})}),delete:async e=>r("comments.php?id=".concat(e),{method:"DELETE"})},i={getAll:async()=>r("templates.php"),get:async e=>r("templates.php?id=".concat(e)),getTasks:async e=>r("templates.php?id=".concat(e,"&tasks=1")),create:async e=>r("templates.php",{method:"POST",body:JSON.stringify(e)}),update:async(e,t)=>r("templates.php?id=".concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:async e=>r("templates.php?id=".concat(e),{method:"DELETE"}),addTask:async(e,t)=>r("templates.php?id=".concat(e,"&action=add_task"),{method:"POST",body:JSON.stringify(t)}),updateTask:async(e,t)=>r("templates.php?task_id=".concat(e),{method:"PUT",body:JSON.stringify(t)}),deleteTask:async e=>r("templates.php?task_id=".concat(e),{method:"DELETE"})}},7280:(e,t,a)=>{a.d(t,{D:()=>s,N:()=>c});var n=a(2372),r=a(2115);let o=(0,r.createContext)(void 0);function c(e){let{children:t}=e,[a,c]=(0,r.useState)("light"),[s,i]=(0,r.useState)("light"),[l,d]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{d(!0);let e=localStorage.getItem("gantt-theme");e&&c(e)},[]),(0,r.useEffect)(()=>{if(!l)return;localStorage.setItem("gantt-theme",a);let e="light";i(e="system"===a?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":a),document.documentElement.classList.remove("light","dark"),document.documentElement.classList.add(e)},[a,l]),(0,n.Y)(o.Provider,{value:{theme:a,setTheme:c,resolvedTheme:s},children:t})}function s(){let e=(0,r.useContext)(o);if(!e)throw Error("useTheme must be used within ThemeProvider");return e}}}]);